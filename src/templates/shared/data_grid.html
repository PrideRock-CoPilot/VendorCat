{# Reusable data-grid table component with sorting and filtering #}
{# Usage: {% include "shared/data_grid.html" with items=items columns=columns sortable=True filterable=True %} #}
<div class="data-grid-container" data-testid="data-grid">
  
  {% if filterable %}
  <div class="data-grid-filters">
    <form method="get" class="filter-form" data-filter-form>
      <label for="search-query" class="filter-label">Search</label>
      <input 
        type="text" 
        id="search-query" 
        name="q" 
        class="filter-input" 
        placeholder="Search records..." 
        value="{{ search_query|default:'' }}"
        aria-label="Search query"
      >
      
      {% if filter_fields %}
        {% for field_name, field_label, field_options in filter_fields %}
          <label for="filter-{{ field_name }}" class="filter-label">{{ field_label }}</label>
          <select 
            id="filter-{{ field_name }}" 
            name="filter_{{ field_name }}" 
            class="filter-select"
            aria-label="Filter by {{ field_label }}"
          >
            <option value="">All {{ field_label|lower }}</option>
            {% for option_value, option_label in field_options %}
              <option value="{{ option_value }}" {% if request.GET.filter_field_name == option_value %}selected{% endif %}>
                {{ option_label }}
              </option>
            {% endfor %}
          </select>
        {% endfor %}
      {% endif %}
      
      <div class="filter-actions">
        <button type="submit" class="button-link primary">Apply</button>
        <a href="{{ reset_url|default:'.' }}" class="button-link subtle">Reset Filters</a>
      </div>
    </form>
  </div>
  {% endif %}

  {% if items %}
    <div class="table-wrap table-scroll">
      <table class="data-table" role="grid" aria-label="Data table">
        <thead>
          <tr role="row">
            {% for column in columns %}
              <th 
                role="columnheader" 
                class="{% if sortable and column.sortable %}sortable{% endif %}"
                {% if sortable and column.sortable %}
                  data-sort-field="{{ column.field }}"
                  aria-sort="{% if current_sort_field == column.field %}{{ current_sort_order|lower }}{% else %}none{% endif %}"
                {% endif %}
              >
                {% if sortable and column.sortable %}
                  <a href="?sort={{ column.field }}&order={% if current_sort_field == column.field and current_sort_order == 'ASC' %}desc{% else %}asc{% endif %}{{ query_string }}" class="sort-link">
                    {{ column.label }}
                    {% if current_sort_field == column.field %}
                      <span class="sort-indicator" aria-hidden="true">
                        {% if current_sort_order == 'ASC' %}▲{% else %}▼{% endif %}
                      </span>
                    {% endif %}
                  </a>
                {% else %}
                  {{ column.label }}
                {% endif %}
              </th>
            {% endfor %}
          </tr>
        </thead>
        <tbody>
          {% for item in items %}
            <tr role="row" class="data-row" data-item-id="{{ item.id|default:item.pk }}">
              {% for column in columns %}
                <td role="cell">
                  {% if column.render_func %}
                    {{ column.render_func|safe }}
                  {% else %}
                    {{ item|get_nested_value:column.field }}
                  {% endif %}
                </td>
              {% endfor %}
            </tr>
          {% empty %}
            <tr class="empty-state">
              <td colspan="{{ columns|length }}" class="empty-message">
                <p>No records found</p>
                {% if search_query %}
                  <p class="muted">Try adjusting your search or filters</p>
                {% endif %}
              </td>
            </tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
  {% else %}
    <div class="empty-state-full">
      <p class="empty-title">No data to display</p>
      <p class="empty-description">Start by adding your first record</p>
    </div>
  {% endif %}

</div>

<style>
  .data-grid-container {
    display: grid;
    gap: 1.5rem;
  }

  .data-grid-filters {
    background: var(--card, #ffffff);
    border: 1px solid var(--line, #d3dde9);
    border-radius: 8px;
    padding: 1.25rem;
  }

  .filter-form {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 1rem;
    align-items: end;
  }

  .filter-label {
    display: block;
    font-size: 0.875rem;
    font-weight: 600;
    color: var(--ink, #0b1f3a);
    margin-bottom: 0.5rem;
  }

  .filter-input,
  .filter-select {
    width: 100%;
    padding: 0.625rem;
    border: 1px solid var(--line, #d3dde9);
    border-radius: 6px;
    font-size: 0.875rem;
    background: var(--card-alt, #f8fbff);
    color: var(--ink, #0b1f3a);
    font-family: inherit;
  }

  .filter-input:focus,
  .filter-select:focus {
    outline: none;
    border-color: var(--brand-bright, #1d4ed8);
    box-shadow: 0 0 0 3px rgba(29, 78, 216, 0.1);
  }

  .filter-actions {
    display: flex;
    gap: 0.75rem;
  }

  .table-wrap.table-scroll {
    overflow-x: auto;
  }

  .data-table {
    width: 100%;
    border-collapse: collapse;
    font-size: 0.875rem;
    background: var(--card, #ffffff);
  }

  .data-table thead {
    background: var(--card-alt, #f8fbff);
    border-bottom: 2px solid var(--line, #d3dde9);
    position: sticky;
    top: 0;
    z-index: 10;
  }

  .data-table th {
    padding: 0.75rem 1rem;
    text-align: left;
    font-weight: 600;
    color: var(--ink, #0b1f3a);
    white-space: nowrap;
    user-select: none;
  }

  .data-table th.sortable {
    cursor: pointer;
    transition: background 0.15s ease;
  }

  .data-table th.sortable:hover {
    background: rgba(15, 118, 110, 0.05);
  }

  .sort-link {
    color: inherit;
    text-decoration: none;
    display: inline-flex;
    align-items: center;
    gap: 0.4rem;
  }

  .sort-indicator {
    font-size: 0.65rem;
    color: var(--brand, #0f766e);
    margin-left: 0.25rem;
  }

  .data-table td {
    padding: 0.75rem 1rem;
    border-bottom: 1px solid var(--line, #d3dde9);
    color: var(--ink, #0b1f3a);
  }

  .data-table tbody tr:nth-child(even) td {
    background: rgba(15, 118, 110, 0.02);
  }

  .data-table tbody tr:hover td {
    background: rgba(15, 118, 110, 0.05);
  }

  .empty-state,
  .empty-state-full {
    padding: 3rem 1rem;
    text-align: center;
    background: var(--card, #ffffff);
    border-radius: 8px;
    border: 1px dashed var(--line, #d3dde9);
  }

  .empty-message {
    color: var(--muted, #475467);
    font-size: 0.875rem;
  }

  .empty-title {
    font-size: 1.125rem;
    font-weight: 600;
    color: var(--ink, #0b1f3a);
    margin: 0 0 0.5rem;
  }

  .empty-description {
    color: var(--muted, #475467);
    margin: 0;
  }

  /* Dark mode */
  body.dark-mode .data-grid-filters {
    background: var(--card, #1e1e1e);
    border-color: #2a2a2a;
  }

  body.dark-mode .filter-label {
    color: var(--ink, #ffffff);
  }

  body.dark-mode .filter-input,
  body.dark-mode .filter-select {
    background: #141414;
    border-color: #2c2c2c;
    color: #f8fafc;
  }

  body.dark-mode .data-table {
    background: var(--card, #1e1e1e);
  }

  body.dark-mode .data-table thead {
    background: #202124;
    border-bottom-color: #2c2c2c;
  }

  body.dark-mode .data-table th {
    color: #e5e7eb;
  }

  body.dark-mode .data-table td {
    color: var(--ink, #ffffff);
    border-bottom-color: #2a2a2a;
  }

  body.dark-mode .data-table tbody tr:nth-child(even) td {
    background: rgba(255, 255, 255, 0.02);
  }

  body.dark-mode .data-table tbody tr:hover td {
    background: rgba(255, 255, 255, 0.05);
  }

  /* Responsive */
  @media (max-width: 768px) {
    .filter-form {
      grid-template-columns: 1fr;
    }
    
    .data-table {
      font-size: 0.75rem;
    }
    
    .data-table th,
    .data-table td {
      padding: 0.5rem;
    }
  }
</style>

{# Template filter for nested object property access #}
{% comment %}
To use this component, you need to add the get_nested_value filter to your template tags.
Example in your Django view's context:
  columns=[
    {'label': 'Name', 'field': 'name', 'sortable': True},
    {'label': 'Status', 'field': 'status', 'sortable': False},
  ]
{% endcomment %}
