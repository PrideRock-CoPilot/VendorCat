{% extends "base.html" %}
{% block content %}
<h1>Admin Permissions</h1>

<div class="grid grid-2">
  <section class="card">
    <h2>Role Grants</h2>
    <table>
      <thead><tr><th>User</th><th>Role</th><th>Active</th><th>Granted By</th><th>Granted At</th></tr></thead>
      <tbody>
        {% for row in role_rows %}
        <tr>
          <td>{{ row.user_principal }}</td>
          <td>{{ row.role_code }}</td>
          <td>{{ row.active_flag }}</td>
          <td>{{ row.granted_by }}</td>
          <td>{{ row.granted_at }}</td>
        </tr>
        {% else %}
        <tr><td colspan="5">No role grants</td></tr>
        {% endfor %}
      </tbody>
    </table>
  </section>
  <section class="card">
    <h2>Org Scope Grants</h2>
    <table>
      <thead><tr><th>User</th><th>Org</th><th>Scope</th><th>Active</th><th>Granted At</th></tr></thead>
      <tbody>
        {% for row in scope_rows %}
        <tr>
          <td>{{ row.user_principal }}</td>
          <td>{{ row.org_id }}</td>
          <td>{{ row.scope_level }}</td>
          <td>{{ row.active_flag }}</td>
          <td>{{ row.granted_at }}</td>
        </tr>
        {% else %}
        <tr><td colspan="5">No scope grants</td></tr>
        {% endfor %}
      </tbody>
    </table>
  </section>
</div>

<div class="grid grid-2">
  <section class="card">
    <h2>Grant Role</h2>
    <form method="post" action="/admin/grant-role" class="grid grid-1">
      <label>User Principal<input type="text" name="target_user" required></label>
      <label>Role
        <select name="role_code">
          {% for role in roles %}
          <option value="{{ role }}">{{ role }}</option>
          {% endfor %}
        </select>
      </label>
      <div><button type="submit">Grant Role</button></div>
    </form>
  </section>
  <section class="card">
    <h2>Grant Org Scope</h2>
    <form method="post" action="/admin/grant-scope" class="grid grid-1">
      <label>User Principal<input type="text" name="target_user" required></label>
      <label>Org ID<input type="text" name="org_id" required></label>
      <label>Scope Level
        <select name="scope_level">
          <option value="read">read</option>
          <option value="edit">edit</option>
          <option value="full">full</option>
        </select>
      </label>
      <div><button type="submit">Grant Scope</button></div>
    </form>
  </section>
</div>
{% endblock %}

