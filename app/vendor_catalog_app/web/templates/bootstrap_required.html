<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Vendor Catalog</title>
  <link rel="icon" type="image/svg+xml" href="/static/favicon.svg">
  <link rel="stylesheet" href="/static/css/app.css">
</head>
<body>
  <main class="container">
    <section class="card section-divider">
      <h1>⚠️ Database Connection Issue</h1>
      <p><strong>The application cannot connect to the Databricks database.</strong></p>
      
      <div style="background: #fff3cd; border-left: 4px solid #ffc107; padding: 1rem; margin: 1rem 0;">
        <p style="margin: 0; font-family: monospace; font-size: 0.9em; white-space: pre-wrap;">{{ error_message }}</p>
      </div>
      
      <h2>Common Issues:</h2>
      <ul style="line-height: 1.8;">
        <li><strong>Missing SQL Warehouse:</strong> The app requires a SQL warehouse resource binding in app.yaml</li>
        <li><strong>Warehouse Permissions:</strong> The app service principal needs CAN_USE permission on the warehouse</li>
        <li><strong>Schema Not Created:</strong> Run the production bootstrap notebook to create runtime objects</li>
        <li><strong>Missing Permissions:</strong> Grant Unity Catalog permissions (USE_CATALOG, USE_SCHEMA, SELECT)</li>
      </ul>
      
      <h2>Troubleshooting:</h2>
      <p><strong>1. View Detailed Diagnostics:</strong></p>
      <p style="margin-left: 2rem;">
        <a href="/bootstrap-diagnostics" style="display: inline-block; padding: 0.5rem 1rem; background: #007bff; color: white; text-decoration: none; border-radius: 4px;">View Full Diagnostics</a>
        {% if connection_lab_enabled %}
        <a href="/connection-lab?next=%2Fdashboard" style="display: inline-block; margin-left: 0.75rem; padding: 0.5rem 1rem; background: #0f766e; color: white; text-decoration: none; border-radius: 4px;">Advanced Connection Lab</a>
        {% endif %}
        <small style="display: block; margin-top: 0.5rem; color: #666;">
          API: <a href="/api/bootstrap-diagnostics">/api/bootstrap-diagnostics</a>
        </small>
      </p>
      
      <p><strong>2. Run Bootstrap Notebook:</strong></p>
      <p style="margin-left: 2rem;">
        <code>setup/production_push/production_push_setup.ipynb</code>
        <br><small style="color: #666;">Use operation=apply and include_seed=true</small>
        <br><small style="color: #666;">Alternate: <code>setup/databricks/notebooks/v1_apply_database_changes.ipynb</code></small>
      </p>
      
      <p><strong>3. Check App Configuration:</strong></p>
      <ul style="margin-left: 2rem;">
        <li>Verify <code>app.yaml</code> has <code>resources:</code> section with warehouse binding</li>
        <li>Ensure warehouse is started (not STOPPED)</li>
        <li>Confirm service principal has warehouse permissions</li>
      </ul>
    </section>
  </main>
</body>
</html>
