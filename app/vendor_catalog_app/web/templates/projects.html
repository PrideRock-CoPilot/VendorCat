{% extends "base.html" %}
{% block content %}
<div class="section-header">
  <div>
    <h1>Projects</h1>
    <p>Global project workspace across all vendors.</p>
  </div>
</div>

<form method="get" action="/projects" class="card grid grid-3">
  <label>
    Search
    <input type="text" name="search" value="{{ filters.search }}" placeholder="Project, owner, vendor, type...">
  </label>
  <label>
    Status
    <select name="status">
      {% for option in status_options %}
      <option value="{{ option }}" {% if option == filters.status %}selected{% endif %}>{{ option }}</option>
      {% endfor %}
    </select>
  </label>
  <label>
    Vendor
    <select name="vendor">
      {% for option in vendor_options %}
      <option value="{{ option.vendor_id }}" {% if option.vendor_id == filters.vendor %}selected{% endif %}>
        {{ option.label }}
      </option>
      {% endfor %}
    </select>
  </label>
  <div>
    <button type="submit">Apply Filters</button>
  </div>
</form>

{% if can_edit and not locked_mode %}
<section class="card section-divider">
  <h2>New Project</h2>
  <p>You can create projects before assigning vendors. Attach vendors and offerings in the project form.</p>
  <a class="button-link" href="/projects/new?return_to=%2Fprojects">Create Project</a>
</section>
{% endif %}

<section class="card section-divider">
  <h2>Project List</h2>
  <table>
    <thead>
      <tr>
        <th>Project</th>
        <th>Vendor</th>
        <th>Status</th>
        <th>Type</th>
        <th>Owner</th>
        <th>Target</th>
        <th>Demos</th>
        <th>Last Activity</th>
        <th>Actions</th>
      </tr>
    </thead>
    <tbody>
    {% for row in rows %}
    <tr>
      <td>{{ row.project_name }}</td>
      <td>{{ row.vendor_display_name }}</td>
      <td>{{ row.status }}</td>
      <td>{{ row.project_type }}</td>
      <td>{{ row.owner_principal }}</td>
      <td>{{ row.target_date }}</td>
      <td>{{ row.demo_count }}</td>
      <td>{{ row.last_activity_at }}</td>
      <td class="button-group">
        <a class="button-link subtle" href="{{ row._open_link }}">Open</a>
        {% if can_edit and not locked_mode %}
        <a class="button-link subtle" href="{{ row._edit_link }}">Edit</a>
        {% endif %}
      </td>
    </tr>
    {% else %}
    <tr><td colspan="9">No projects found.</td></tr>
    {% endfor %}
    </tbody>
  </table>
</section>
{% endblock %}
