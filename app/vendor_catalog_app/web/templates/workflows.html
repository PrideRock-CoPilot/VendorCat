{% extends "base.html" %}
{% block content %}
<h1>Pending Approvals</h1>

<section class="card section-divider">
  <form method="get" action="/workflows" class="grid grid-5 form-grid">
    <label>Queue
      <select name="queue">
        {% for value in queue_options %}
        <option value="{{ value }}" {% if value == selected_queue %}selected{% endif %}>{{ value }}</option>
        {% endfor %}
      </select>
    </label>
    <label>Status
      <select name="status">
        {% for value in status_options %}
        <option value="{{ value }}" {% if value == selected_status %}selected{% endif %}>{{ value }}</option>
        {% endfor %}
      </select>
    </label>
    <label>LOB
      <select name="lob">
        <option value="all" {% if selected_lob == 'all' %}selected{% endif %}>all</option>
        {% for value in lob_options %}
        <option value="{{ value }}" {% if value == selected_lob %}selected{% endif %}>{{ value }}</option>
        {% endfor %}
      </select>
    </label>
    <label>Requester
      <select name="requestor">
        <option value="all" {% if selected_requestor == 'all' %}selected{% endif %}>all</option>
        {% for value in requestor_options %}
        <option value="{{ value }}" {% if value == selected_requestor %}selected{% endif %}>{{ value }}</option>
        {% endfor %}
      </select>
    </label>
    <label>Assignee
      <select name="assignee">
        <option value="all" {% if selected_assignee == 'all' %}selected{% endif %}>all</option>
        {% for value in assignee_options %}
        <option value="{{ value }}" {% if value == selected_assignee %}selected{% endif %}>{{ value }}</option>
        {% endfor %}
      </select>
    </label>
    <label class="full">People Search
      <input type="text" name="people" value="{{ selected_people }}" placeholder="Filter by person, type, vendor, or notes">
    </label>
    <div class="form-actions"><button type="submit">Apply Filters</button></div>
  </form>
</section>

<section class="card section-divider">
  <table>
    <thead>
      <tr>
        <th>Request ID</th>
        <th>Vendor</th>
        <th>Type</th>
        <th>Requester</th>
        <th>Status</th>
        <th>Approval Level</th>
        <th>LOB</th>
        <th>Assignee</th>
        <th>Summary</th>
        <th>Submitted</th>
      </tr>
    </thead>
    <tbody>
      {% for row in rows %}
      <tr>
        <td>
          <a href="/workflows/{{ row.change_request_id }}?return_to={{ current_view_url_encoded }}">{{ row.change_request_id }}</a>
        </td>
        <td>{{ row._vendor_display }}</td>
        <td>{{ row.change_type }}</td>
        <td>{{ row.requestor_user_principal }}</td>
        <td>{{ row.status }}</td>
        <td>{{ row._approval_label }}</td>
        <td>{{ row._lob_display }}</td>
        <td>{{ row._assignee }}</td>
        <td>{{ row._summary }}</td>
        <td>{{ row.submitted_at }}</td>
      </tr>
      {% else %}
      <tr><td colspan="10">No approval requests.</td></tr>
      {% endfor %}
    </tbody>
  </table>
</section>
{% endblock %}
