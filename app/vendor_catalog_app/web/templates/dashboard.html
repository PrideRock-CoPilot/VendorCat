{% extends "base.html" %}
{% block content %}
<h1>Executive Overview</h1>

<form method="get" action="/dashboard" class="card grid grid-3">
  <label>
    Line of Business
    <select name="lob">
      {% for option in orgs %}
      <option value="{{ option }}" {% if option == selected_lob %}selected{% endif %}>{{ "All Lines of Business" if option == "all" else option }}</option>
      {% endfor %}
    </select>
  </label>
  <label>
    Spend Window (months)
    <select name="months">
      {% for m in [3, 6, 9, 12, 18, 24] %}
      <option value="{{ m }}" {% if m == months %}selected{% endif %}>{{ m }}</option>
      {% endfor %}
    </select>
  </label>
  <label>
    Renewal Horizon (days)
    <select name="horizon_days">
      {% for d in [60, 90, 120, 180, 270, 365] %}
      <option value="{{ d }}" {% if d == horizon_days %}selected{% endif %}>{{ d }}</option>
      {% endfor %}
    </select>
  </label>
  <div>
    <button type="submit">Apply</button>
  </div>
</form>

<section class="metrics">
  <div class="metric"><span>Active Vendors</span><strong>{{ kpis.active_vendors }}</strong></div>
  <div class="metric"><span>Active Offerings</span><strong>{{ kpis.active_offerings }}</strong></div>
  <div class="metric"><span>Spend ({{ months }}m)</span><strong>${{ "{:,.0f}".format(summary.total_spend_window) }}</strong></div>
  <div class="metric"><span>High/Critical Risk</span><strong>{{ summary.high_risk_vendors|int }}</strong></div>
  <div class="metric"><span>Renewals Due</span><strong>{{ summary.renewals_due_count|int }}</strong></div>
  <div class="metric"><span>Not-Selected Demo Rate</span><strong>{{ "{:.1f}%".format(summary.not_selected_demo_rate * 100) }}</strong></div>
</section>

<div class="grid grid-2">
  <section class="card">
    <h2>Spend By Category</h2>
    <table>
      <thead><tr><th>Category</th><th>Total Spend</th></tr></thead>
      <tbody>
      {% for row in by_category %}
      <tr><td>{{ row.category }}</td><td>${{ "{:,.0f}".format(row.total_spend) }}</td></tr>
      {% else %}
      <tr><td colspan="2">No data</td></tr>
      {% endfor %}
      </tbody>
    </table>
  </section>
  <section class="card">
    <h2>Monthly Spend Trend</h2>
    <table>
      <thead><tr><th>Month</th><th>Spend</th></tr></thead>
      <tbody>
      {% for row in trend %}
      <tr><td>{{ row.month }}</td><td>${{ "{:,.0f}".format(row.total_spend) }}</td></tr>
      {% else %}
      <tr><td colspan="2">No data</td></tr>
      {% endfor %}
      </tbody>
    </table>
  </section>
</div>

<div class="grid grid-2">
  <section class="card">
    <h2>Top Vendors By Spend</h2>
    <table>
      <thead><tr><th>Vendor</th><th>Risk</th><th>Total Spend</th></tr></thead>
      <tbody>
      {% for row in top_vendors %}
      <tr><td>{{ row.vendor_name }}</td><td>{{ row.risk_tier }}</td><td>${{ "{:,.0f}".format(row.total_spend) }}</td></tr>
      {% else %}
      <tr><td colspan="3">No data</td></tr>
      {% endfor %}
      </tbody>
    </table>
  </section>
  <section class="card">
    <h2>Risk Distribution</h2>
    <table>
      <thead><tr><th>Risk Tier</th><th>Vendor Count</th></tr></thead>
      <tbody>
      {% for row in risk_dist %}
      <tr><td>{{ row.risk_tier }}</td><td>{{ row.vendor_count }}</td></tr>
      {% else %}
      <tr><td colspan="2">No data</td></tr>
      {% endfor %}
      </tbody>
    </table>
  </section>
</div>

<div class="grid grid-2">
  <section class="card">
    <h2>Renewal Pipeline ({{ horizon_days }} days)</h2>
    <table>
      <thead>
        <tr><th>Contract</th><th>Vendor</th><th>Renewal Date</th><th>Annual Value</th><th>Status</th></tr>
      </thead>
      <tbody>
      {% for row in renewals %}
      <tr>
        <td>{{ row.contract_id }}</td>
        <td>{{ row.vendor_name or row.vendor_id }}</td>
        <td>{{ row.renewal_date }}</td>
        <td>${{ "{:,.0f}".format(row.annual_value or 0) }}</td>
        <td>{{ row.renewal_status }}</td>
      </tr>
      {% else %}
      <tr><td colspan="5">No renewals in horizon</td></tr>
      {% endfor %}
      </tbody>
    </table>
  </section>
  <section class="card">
    <h2>Recent Demo Outcomes</h2>
    <table>
      <thead><tr><th>Demo</th><th>Vendor</th><th>Outcome</th><th>Score</th></tr></thead>
      <tbody>
      {% for row in recent_demos %}
      <tr><td>{{ row.demo_id }}</td><td>{{ row.vendor_id }}</td><td>{{ row.selection_outcome }}</td><td>{{ row.overall_score }}</td></tr>
      {% else %}
      <tr><td colspan="4">No demo data</td></tr>
      {% endfor %}
      </tbody>
    </table>
  </section>
</div>

<div class="grid grid-2">
  <section class="card">
    <h2>Recent Contract Cancellations</h2>
    <table>
      <thead><tr><th>Contract</th><th>Vendor</th><th>Cancelled At</th><th>Reason</th></tr></thead>
      <tbody>
      {% for row in recent_cancellations %}
      <tr>
        <td>{{ row.contract_id }}</td>
        <td>{{ row.vendor_id }}</td>
        <td>{{ row.cancelled_at }}</td>
        <td>{{ row.reason_code }}</td>
      </tr>
      {% else %}
      <tr><td colspan="4">No recent cancellations</td></tr>
      {% endfor %}
      </tbody>
    </table>
  </section>
  <section class="card">
    <h2>Operational Shortcuts</h2>
    <p class="muted">Jump directly to high-frequency workflows.</p>
    <div class="empty-state-actions">
      <a class="button-link subtle" href="/contracts">Open Contracts Hub</a>
      <a class="button-link subtle" href="/vendor-360">Open Vendor 360</a>
      <a class="button-link subtle" href="/reports">Open Reports</a>
    </div>
  </section>
</div>
{% endblock %}
