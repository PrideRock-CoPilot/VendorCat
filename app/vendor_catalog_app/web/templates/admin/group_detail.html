{% extends "base.html" %}

{% block head %}
  <link rel="stylesheet" href="/static/css/admin_portal.css">
{% endblock %}

{% block content %}
<div class="section-header">
  <div>
    <h1>Group Access Detail</h1>
    <p>{{ group_principal }}</p>
  </div>
</div>

{% include "admin/_nav.html" %}

<section class="card">
  <h2>Group Role Grants</h2>
  {% set pager = group_pager %}
  {% include "admin/_pagination.html" %}
  <table>
    <thead><tr><th>Role</th><th>Active</th><th>Granted By</th><th>Granted At</th><th>Revoked At</th><th>Actions</th></tr></thead>
    <tbody>
      {% for row in group_role_rows %}
      {% set is_active = row.active_flag in [True, 1, "1", "true", "True"] %}
      <tr>
        <td><a href="/admin/roles/{{ row.role_code }}">{{ row.role_code }}</a></td>
        <td>{{ row.active_flag }}</td>
        <td>{{ row.granted_by }}</td>
        <td>{{ row.granted_at }}</td>
        <td>{{ row.revoked_at or '-' }}</td>
        <td>
          {% if is_active %}
          <div class="inline-form">
            <form method="post" action="/admin/change-group-role" class="inline-form">
              <input type="hidden" name="target_group" value="{{ group_principal }}">
              <input type="hidden" name="current_role_code" value="{{ row.role_code }}">
              <select name="new_role_code">
                {% for role in grantable_roles %}
                <option value="{{ role }}" {% if role == row.role_code %}selected{% endif %}>{{ role }}</option>
                {% endfor %}
              </select>
              <button type="submit">Change</button>
            </form>
            <form method="post" action="/admin/revoke-group-role" class="inline-form">
              <input type="hidden" name="target_group" value="{{ group_principal }}">
              <input type="hidden" name="role_code" value="{{ row.role_code }}">
              <button type="submit">Revoke</button>
            </form>
          </div>
          {% else %}
          <span class="muted">revoked</span>
          {% endif %}
        </td>
      </tr>
      {% else %}
      <tr><td colspan="6">No group role grants for this group.</td></tr>
      {% endfor %}
    </tbody>
  </table>

  <h3 style="margin-top:10px;">Grant Group Role</h3>
  <form method="post" action="/admin/grant-group-role" class="inline-form" style="margin-top:10px;">
    <input type="hidden" name="target_group" value="{{ group_principal }}">
    <label>Role
      <select name="role_code">
        {% for role in grantable_roles %}
        <option value="{{ role }}">{{ role }}</option>
        {% endfor %}
      </select>
    </label>
    <button type="submit">Grant Group Role</button>
  </form>
</section>
{% endblock %}

{% block scripts %}
<script src="/static/js/admin_portal.js"></script>
{% endblock %}
