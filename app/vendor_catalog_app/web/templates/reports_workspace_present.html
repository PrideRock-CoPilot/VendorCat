{% extends "base.html" %}
{% block content %}
<div class="section-header">
  <div>
    <h1>Presentation Mode</h1>
    <p>{{ board.board_name }} includes {{ widget_views|length }} widget{% if widget_views|length != 1 %}s{% endif %}.</p>
  </div>
  <div class="button-group">
    <a class="button-link subtle" href="/reports/workspace?board={{ board.board_id }}">Back To Designer</a>
    <a class="button-link subtle" href="/reports/workspace/boards/export?board={{ board.board_id }}">Export Board Bundle</a>
  </div>
</div>

<div class="grid grid-2 reports-present-grid">
  {% for widget in widget_views %}
  <section class="card section-divider reports-present-widget">
    <div class="section-header">
      <div>
        <h2>{{ widget.title }}</h2>
        <p class="muted">{{ widget.report_label }} | {{ widget.widget_type }} | {{ widget.view_mode }} | {{ widget.row_count }} rows</p>
      </div>
      <div class="button-group">
        <a class="button-link subtle" href="{{ widget.run_url }}" target="_blank" rel="noopener noreferrer">Open Runner</a>
      </div>
    </div>

    {% if widget.show_chart %}
      {% if widget.chart_rows %}
        {% if widget.chart_kind == "line" %}
        <svg class="line-chart" viewBox="0 0 100 100" preserveAspectRatio="none" aria-label="line chart">
          <line class="axis-line" x1="5" y1="90" x2="95" y2="90"></line>
          <line class="axis-line" x1="5" y1="10" x2="5" y2="90"></line>
          <polyline class="trend-line" points="{{ widget.chart_line_path }}"></polyline>
          {% for point in widget.chart_line_points %}
          <circle class="trend-point" cx="{{ point.x }}" cy="{{ point.y }}" r="1.4">
            <title>{{ point.label }}: {{ point.value_display }}</title>
          </circle>
          {% endfor %}
        </svg>
        {% else %}
        <div class="graph-block">
          {% for row in widget.chart_rows %}
          <div class="bar-row">
            <div class="bar-label">{{ row.label }}</div>
            <div class="bar-track"><div class="bar-fill" style="width: {{ row.width_pct }}%;"></div></div>
            <div class="bar-value">{{ row.value_display }} <small class="muted">({{ row.share_pct }}%)</small></div>
          </div>
          {% endfor %}
        </div>
        {% endif %}
      {% else %}
      <p class="muted">No chartable rows for this widget.</p>
      {% endif %}
    {% endif %}

    {% if widget.show_table %}
    <div class="table-wrap table-scroll" style="margin-top:10px;">
      <table>
        <thead>
          <tr>
            {% for column in widget.preview_columns %}
            <th>{{ column }}</th>
            {% endfor %}
          </tr>
        </thead>
        <tbody>
          {% for row in widget.preview_rows %}
          <tr>
            {% for column in widget.preview_columns %}
            <td>{{ row[column] }}</td>
            {% endfor %}
          </tr>
          {% else %}
          <tr><td colspan="{{ widget.preview_columns|length if widget.preview_columns else 1 }}">No preview rows.</td></tr>
          {% endfor %}
        </tbody>
      </table>
    </div>
    {% endif %}
  </section>
  {% endfor %}
</div>
{% endblock %}
