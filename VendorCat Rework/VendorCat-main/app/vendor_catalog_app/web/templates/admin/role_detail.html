{% extends "base.html" %}

{% block head %}
  <link rel="stylesheet" href="/static/css/admin_portal.css">
{% endblock %}

{% block content %}
<div class="section-header">
  <div>
    <h1>Role Detail</h1>
    <p>{{ role_row.role_name }} ({{ role_row.role_code }})</p>
  </div>
</div>

{% include "admin/_nav.html" %}

<section class="card">
  <h2>Role Definition</h2>
  <p><strong>Description:</strong> {{ role_row.description or '-' }}</p>
  <p><strong>Approval Level:</strong> {{ role_row.approval_level }}</p>
  <p><strong>Capabilities:</strong> edit={{ role_row.can_edit }}, report={{ role_row.can_report }}, direct_apply={{ role_row.can_direct_apply }}</p>
  <p><strong>Change Permissions:</strong> {{ role_row.actions_summary }}</p>
</section>

<div class="grid grid-2 admin-grants-grid">
  <section class="card">
    <h2>User Grants For Role</h2>
    {% set pager = user_pager %}
    {% include "admin/_pagination.html" %}
    <table>
      <thead><tr><th>User</th><th>Active</th><th>Granted By</th><th>Granted At</th></tr></thead>
      <tbody>
        {% for row in role_user_rows %}
        <tr>
          <td><a href="/admin/users/{{ row.user_principal }}">{{ row.user_principal }}</a></td>
          <td>{{ row.active_flag }}</td>
          <td>{{ row.granted_by }}</td>
          <td>{{ row.granted_at }}</td>
        </tr>
        {% else %}
        <tr><td colspan="4">No user grants for this role.</td></tr>
        {% endfor %}
      </tbody>
    </table>
  </section>

  <section class="card">
    <h2>Group Grants For Role</h2>
    {% set pager = group_pager %}
    {% include "admin/_pagination.html" %}
    <table>
      <thead><tr><th>Group</th><th>Active</th><th>Granted By</th><th>Granted At</th></tr></thead>
      <tbody>
        {% for row in role_group_rows %}
        <tr>
          <td><a href="/admin/groups/{{ row.group_principal }}">{{ row.group_principal }}</a></td>
          <td>{{ row.active_flag }}</td>
          <td>{{ row.granted_by }}</td>
          <td>{{ row.granted_at }}</td>
        </tr>
        {% else %}
        <tr><td colspan="4">No group grants for this role.</td></tr>
        {% endfor %}
      </tbody>
    </table>
  </section>
</div>
{% endblock %}
