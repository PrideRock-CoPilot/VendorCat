{% macro owner_principal_input(field_name, value="", label="Owner Principal", placeholder="user@company.com", required=false) -%}
{% set display_name_field = field_name ~ "_display_name" %}
<div class="owner-principal-picker full" data-user-picker>
  <label>
    {{ label }} Display Name
    <div class="typeahead-block">
      <input
        type="text"
        name="{{ display_name_field }}"
        value=""
        placeholder="Jane Doe"
        autocomplete="off"
        data-user-search
        data-user-search-mode="display_name"
        data-user-search-pair="{{ field_name }}"
      >
      <div class="typeahead-results hidden" data-user-results></div>
    </div>
  </label>
  <label>
    {{ label }} Email
    <div class="typeahead-block">
      <input
        type="text"
        name="{{ field_name }}"
        value="{{ value }}"
        placeholder="{{ placeholder }}"
        autocomplete="off"
        data-user-search
        data-user-search-mode="email"
        data-user-search-pair="{{ field_name }}"
        {% if required %}required{% endif %}
      >
      <div class="typeahead-results hidden" data-user-results></div>
    </div>
  </label>
  <small class="muted">Search by display name or email, then choose a match to validate user identity.</small>
</div>
{%- endmacro %}


{% macro select_input(field_name, label, options, selected="", required=false) -%}
<label>{{ label }}
  <select name="{{ field_name }}" {% if required %}required{% endif %}>
    {% for option in options %}
    <option value="{{ option }}" {% if option == selected %}selected{% endif %}>{{ option|replace('_', ' ')|title }}</option>
    {% endfor %}
  </select>
</label>
{%- endmacro %}


{% macro project_owner_update_form(post_url, return_to, owner_value="", submit_label="Save Owner") -%}
<form method="post" action="{{ post_url }}" class="grid grid-2 form-grid" style="margin-bottom:10px;">
  <input type="hidden" name="return_to" value="{{ return_to }}">
  {{ owner_principal_input("owner_principal", owner_value, "Owner Principal", "user@company.com") }}
  <label>Reason <span class="field-error">*</span>
    <select name="reason" required>
      <option value="" selected disabled>Select reason</option>
      {% for option in project_owner_change_reason_options %}
      <option value="{{ option }}">{{ option|replace('_', ' ')|title }}</option>
      {% endfor %}
    </select>
  </label>
  <div class="form-actions"><button type="submit">{{ submit_label }}</button></div>
</form>
{%- endmacro %}


{% macro offering_owner_add_form(post_url, return_to, default_role="business_owner", submit_label="Add Owner") -%}
{% set owner_role_values = owner_role_options|default(["business_owner", "executive_owner", "service_owner", "technical_owner", "security_owner", "application_owner", "platform_owner", "legacy_owner"], true) %}
{% set reason_options = owner_add_reason_options|default(["new_assignment", "coverage_backup", "role_change", "org_change", "other"], true) %}
<form method="post" action="{{ post_url }}" class="grid grid-2 form-grid">
  <input type="hidden" name="return_to" value="{{ return_to }}">
  {{ owner_principal_input("owner_user_principal", "", "Owner Principal", "user@company.com", true) }}
  {{ select_input("owner_role", "Role", owner_role_values, default_role or "business_owner", true) }}
  <label class="full">Reason
    <select name="reason">
      <option value="">Optional</option>
      {% for option in reason_options %}
      <option value="{{ option }}">{{ option|replace('_', ' ')|title }}</option>
      {% endfor %}
    </select>
  </label>
  <div class="form-actions"><button type="submit">{{ submit_label }}</button></div>
</form>
{%- endmacro %}


{% macro vendor_owner_add_form(post_url, return_to, default_role="business_owner", submit_label="Add Owner") -%}
{% set owner_role_values = owner_role_options|default(["business_owner", "executive_owner", "service_owner", "technical_owner", "security_owner", "application_owner", "platform_owner", "legacy_owner"], true) %}
{% set reason_options = owner_add_reason_options|default(["new_assignment", "coverage_backup", "role_change", "org_change", "other"], true) %}
<form method="post" action="{{ post_url }}" class="grid grid-2 form-grid">
  <input type="hidden" name="return_to" value="{{ return_to }}">
  {{ owner_principal_input("owner_user_principal", "", "Owner Principal", "user@company.com", true) }}
  {{ select_input("owner_role", "Role", owner_role_values, default_role or "business_owner", true) }}
  <label class="full">Reason
    <select name="reason">
      <option value="">Optional</option>
      {% for option in reason_options %}
      <option value="{{ option }}">{{ option|replace('_', ' ')|title }}</option>
      {% endfor %}
    </select>
  </label>
  <div class="form-actions"><button type="submit">{{ submit_label }}</button></div>
</form>
{%- endmacro %}


{% macro vendor_org_assignment_add_form(post_url, return_to, submit_label="Add Assignment") -%}
{% set assignment_type_values = assignment_type_options|default(["consumer", "primary", "secondary"], true) %}
{% set reason_options = org_assignment_reason_options|default(["new_assignment", "org_change", "scope_change", "ownership_alignment", "other"], true) %}
<form method="post" action="{{ post_url }}" class="grid grid-2 form-grid">
  <input type="hidden" name="return_to" value="{{ return_to }}">
    <label>Business Unit <span class="field-error">*</span>
    <input type="text" name="org_id" placeholder="IT-ENT" required>
  </label>
  {{ select_input("assignment_type", "Assignment Type", assignment_type_values, "consumer", true) }}
  <label class="full">Reason
    <select name="reason">
      <option value="">Optional</option>
      {% for option in reason_options %}
      <option value="{{ option }}">{{ option|replace('_', ' ')|title }}</option>
      {% endfor %}
    </select>
  </label>
  <div class="form-actions"><button type="submit">{{ submit_label }}</button></div>
</form>
{%- endmacro %}


{% macro vendor_contact_add_form(post_url, return_to, submit_label="Add Contact") -%}
{% set contact_type_values = contact_type_options|default(["business", "account_manager", "support", "escalation", "security_specialist", "customer_success", "product_manager"], true) %}
{% set reason_options = contact_add_reason_options|default(["new_contact", "coverage_backup", "org_change", "directory_sync", "other"], true) %}
<form method="post" action="{{ post_url }}" class="grid grid-2 form-grid">
  <input type="hidden" name="return_to" value="{{ return_to }}">
  <div class="owner-principal-picker full" data-contact-picker>
    <label>
      Contact Name
      <div class="typeahead-block">
        <input
          type="text"
          name="full_name"
          placeholder="Jane Doe"
          autocomplete="off"
          data-contact-search
          data-contact-search-mode="name"
          data-contact-search-pair="vendor_contact"
          required
        >
        <div class="typeahead-results hidden" data-contact-results></div>
      </div>
    </label>
    <label>
      Contact Email
      <div class="typeahead-block">
        <input
          type="email"
          name="email"
          placeholder="jane.doe@example.com"
          autocomplete="off"
          data-contact-search
          data-contact-search-mode="email"
          data-contact-search-pair="vendor_contact"
        >
        <div class="typeahead-results hidden" data-contact-results></div>
      </div>
    </label>
    <small class="muted">Search existing vendor/offering contacts by name, email, or phone to reuse saved contact information.</small>
  </div>
  {{ select_input("contact_type", "Type", contact_type_values, "business", true) }}
  <label>Phone
    <input type="text" name="phone" placeholder="555-0100" data-contact-phone data-contact-search-pair="vendor_contact">
  </label>
  <label class="full">Reason
    <select name="reason">
      <option value="">Optional</option>
      {% for option in reason_options %}
      <option value="{{ option }}">{{ option|replace('_', ' ')|title }}</option>
      {% endfor %}
    </select>
  </label>
  <div class="form-actions"><button type="submit">{{ submit_label }}</button></div>
</form>
{%- endmacro %}


{% macro offering_contact_add_form(post_url, return_to, submit_label="Add Contact") -%}
{% set contact_type_values = contact_type_options|default(["business", "account_manager", "support", "escalation", "security_specialist", "customer_success", "product_manager"], true) %}
{% set reason_options = contact_add_reason_options|default(["new_contact", "coverage_backup", "org_change", "directory_sync", "other"], true) %}
<form method="post" action="{{ post_url }}" class="grid grid-2 form-grid">
  <input type="hidden" name="return_to" value="{{ return_to }}">
  <div class="owner-principal-picker full" data-contact-picker>
    <label>
      Contact Name
      <div class="typeahead-block">
        <input
          type="text"
          name="full_name"
          placeholder="Bob Smith"
          autocomplete="off"
          data-contact-search
          data-contact-search-mode="name"
          data-contact-search-pair="offering_contact"
          required
        >
        <div class="typeahead-results hidden" data-contact-results></div>
      </div>
    </label>
    <label>
      Contact Email
      <div class="typeahead-block">
        <input
          type="email"
          name="email"
          placeholder="bob.smith@xyzcorp.com"
          autocomplete="off"
          data-contact-search
          data-contact-search-mode="email"
          data-contact-search-pair="offering_contact"
        >
        <div class="typeahead-results hidden" data-contact-results></div>
      </div>
    </label>
    <small class="muted">Search existing vendor/offering contacts by name, email, or phone to reuse saved contact information.</small>
  </div>
  {{ select_input("contact_type", "Type", contact_type_values, "business", true) }}
  <label>Phone
    <input type="text" name="phone" placeholder="555-0100" data-contact-phone data-contact-search-pair="offering_contact">
  </label>
  <label class="full">Reason
    <select name="reason">
      <option value="">Optional</option>
      {% for option in reason_options %}
      <option value="{{ option }}">{{ option|replace('_', ' ')|title }}</option>
      {% endfor %}
    </select>
  </label>
  <div class="form-actions"><button type="submit">{{ submit_label }}</button></div>
</form>
{%- endmacro %}
